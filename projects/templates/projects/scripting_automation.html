{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Automation Script - IT-312 Projects</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: rgb(43, 41, 41);
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 500;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-5px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .project-title {
            color: rgb(49, 47, 47);
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .project-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .demo-section {
            margin-bottom: 40px;
        }

        .demo-title {
            font-size: 2rem;
            color: #150546;
            margin-bottom: 20px;
            text-align: center;
        }

        .automation-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .control-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
        }

        .control-title {
            font-size: 1.3rem;
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #f5576c;
            box-shadow: 0 0 0 3px rgba(245, 87, 108, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            margin-bottom: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 87, 108, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .email-preview {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .email-header {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .email-field {
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .email-field strong {
            color: #2d3748;
            margin-right: 10px;
        }

        .email-body {
            line-height: 1.6;
            color: #4a5568;
        }

        .schedule-status {
            background: #e6fffa;
            border: 2px solid #4fd1c7;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .schedule-status.active {
            background: #f0fff4;
            border-color: #48bb78;
        }

        .schedule-status.inactive {
            background: #fffaf0;
            border-color: #ed8936;
        }

        .status-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .logs-section {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #4a5568;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #81e6d9;
            margin-right: 10px;
        }

        .log-success {
            color: #68d391;
        }

        .log-error {
            color: #fc8181;
        }

        .log-info {
            color: #90cdf4;
        }

        .tech-details {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px solid #e2e8f0;
        }

        .tech-title {
            font-size: 1.8rem;
            color: #150546;
            margin-bottom: 20px;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tech-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #f5576c;
        }

        .tech-item h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .tech-item p {
            color: #4a5568;
            line-height: 1.6;
        }

        .code-section {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .code-title {
            color: #f093fb;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .code {
            font-family: 'Courier New', monospace;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .email-list {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .email-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e2e8f0;
        }

        .remove-btn {
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .message-area {
            margin: 20px 0;
        }

        .success-message {
            background: #c6f6d5;
            color: #276749;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #38a169;
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e53e3e;
        }

        @media (max-width: 768px) {
            .automation-controls {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1040px) {
            .container {
                padding-top: 50px;
            }

            .back-btn {
                border: 1px solid rgba(94, 85, 85, 0.486);
            }
        }
    </style>
</head>

<body>
    <a href="{% url 'home' %}" class="back-btn">‚Üê Back to Dashboard</a>

    <div class="container">
        <div class="header">
            <h1 class="project-title"> Email Automation Script</h1>
            <p class="project-subtitle">Automated daily fun facts delivery system with scheduling and monitoring</p>
        </div>

        <div class="main-card">
            <!-- Demo Section -->
            <div class="demo-section">
                <!-- <h2 class="demo-title">üìß Email Automation Dashboard</h2> -->

                <!-- Automation Controls -->
                <div class="automation-controls">
                    <!-- Email Configuration -->
                    <div class="control-section">
                        <h3 class="control-title">üìã Email Configuration</h3>

                        <div class="form-group">
                            <label for="senderEmail">Sender Email:</label>
                            <input type="email" id="senderEmail" class="form-control" value="automation@funfacts.com"
                                readonly>
                        </div>

                        <div class="form-group">
                            <label for="emailSubject">Email Subject:</label>
                            <input type="text" id="emailSubject" class="form-control"
                                value="üéØ Daily Fun Fact - {date}">
                        </div>

                        <div class="form-group">
                            <label for="recipientEmail">Add Recipient:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="email" id="recipientEmail" class="form-control"
                                    placeholder="recipient@example.com">
                                <button class="btn btn-secondary" onclick="addRecipient()">Add</button>
                            </div>
                        </div>

                        <!-- <div class="email-list" id="emailList">
                            <div class="email-item">
                                <span>demo@example.com</span>
                                <button class="remove-btn" onclick="removeRecipient(this)">Remove</button>
                            </div>
                            <div class="email-item">
                                <span>test@student.edu</span>
                                <button class="remove-btn" onclick="removeRecipient(this)">Remove</button>
                            </div>
                        </div> -->
                    </div>

                    <!-- Schedule Configuration -->
                    <div class="control-section">
                        <h3 class="control-title">‚è∞ Schedule Configuration</h3>

                        <div class="form-group">
                            <label for="scheduleTime">Daily Send Time:</label>
                            <input type="time" id="scheduleTime" class="form-control" value="09:00">
                        </div>

                        <div class="form-group">
                            <label for="timezone">Timezone:</label>
                            <select id="timezone" class="form-control">
                                <option value="UTC+8">UTC+8 (Philippine Time)</option>
                                <option value="UTC+0">UTC+0 (GMT)</option>
                                <option value="UTC-5">UTC-5 (EST)</option>
                                <option value="UTC-8">UTC-8 (PST)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="apiSource">Fun Facts API Source:</label>
                            <select id="apiSource" class="form-control">
                                <option value="uselessfacts">Useless Facts API</option>
                                <option value="catfacts">Cat Facts API</option>
                                <option value="numberfacts">Number Facts API</option>
                            </select>
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" id="toggleSchedule" onclick="toggleSchedule()">
                                ‚ñ∂Ô∏è Start Automation
                            </button>
                            <button class="btn btn-secondary" onclick="sendTestEmail()">
                                üìß Send Test Email
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Schedule Status -->
                <div class="schedule-status inactive" id="scheduleStatus">
                    <div class="status-icon">‚è∏Ô∏è</div>
                    <h3>Automation Status: <span id="statusText">Inactive</span></h3>
                    <p id="statusDescription">Click "Start Automation" to begin daily email scheduling</p>
                    <p><strong>Next Scheduled Email:</strong> <span id="nextEmail">Not scheduled</span></p>
                </div>

                <!-- Email Preview -->
                <div class="email-preview">
                    <h3 style="color: #2d3748; margin-bottom: 20px;">üì¨ Email Preview</h3>
                    <div class="email-header">
                        <div class="email-field">
                            <strong>From:</strong> <span id="previewFrom">Fun Facts Automation
                                &lt;automation@funfacts.com&gt;</span>
                        </div>
                        <div class="email-field">
                            <strong>To:</strong> <span id="previewTo">Recipients List (2 emails)</span>
                        </div>
                        <div class="email-field">
                            <strong>Subject:</strong> <span id="previewSubject">üéØ Daily Fun Fact - December 28,
                                2024</span>
                        </div>
                    </div>
                    <div class="email-body" id="previewBody">
                        <h2>üéØ Your Daily Fun Fact!</h2>
                        <p>Hello there! üëã</p>
                        <p>Here's an amazing fun fact to brighten your day:</p>
                        <blockquote
                            style="background: #f8fafc; padding: 20px; border-left: 4px solid #6552ff; margin: 20px 0; font-style: italic;">
                            <span id="factContent">"Loading fun fact..."</span>
                        </blockquote>
                        <p>Hope you found this interesting! üåü</p>
                        <hr style="margin: 20px 0;">
                        <small style="color: #718096;">
                            This email was sent automatically by the IT-312 Email Automation System.<br>
                            Powered by Fun Facts API ‚Ä¢ Built with Python & Django
                        </small>
                    </div>
                </div>
                <!-- Message Area -->
                <div class="message-area" id="messageArea"></div>
            </div>

            <!-- Technical Details -->
            <!-- <div class="tech-details">
                <h3 class="tech-title">üîß Technical Implementation</h3>

                <div class="tech-grid">
                    <div class="tech-item">
                        <h4>API Integration</h4>
                        <p>Fetches daily fun facts from external APIs with error handling and retry mechanisms.</p>
                    </div>

                    <div class="tech-item">
                        <h4>Email Automation</h4>
                        <p>Uses SMTP protocol to send automated emails with HTML templates and attachments.</p>
                    </div>

                    <div class="tech-item">
                        <h4>Task Scheduling</h4>
                        <p>Implements cron-like scheduling for daily email delivery at specified times.</p>
                    </div>

                    <div class="tech-item">
                        <h4>Logging System</h4>
                        <p>Comprehensive logging for monitoring automation status and debugging issues.</p>
                    </div>
                </div>

            </div> -->
        </div>
    </div>

    <script>
        let isAutomationActive = false;
        let logCounter = 4;

        // Initialize fun fact preview
        document.addEventListener('DOMContentLoaded', function () {
            loadPreviewFact();
        });

        async function loadPreviewFact() {
            try {
                const response = await fetch('https://uselessfacts.jsph.pl/random.json?language=en');
                const data = await response.json();
                document.getElementById('factContent').textContent = data.text;
            } catch (error) {
                document.getElementById('factContent').textContent = "Did you know? Honey never spoils! It has been found in ancient Egyptian tombs and is still edible.";
            }
        }

        function addRecipient() {
            const emailInput = document.getElementById('recipientEmail');
            const email = emailInput.value.trim();

            if (!email) {
                showMessage('Please enter an email address', 'error');
                return;
            }

            if (!isValidEmail(email)) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }

            const emailList = document.getElementById('emailList');
            const emailItem = document.createElement('div');
            emailItem.className = 'email-item';
            emailItem.innerHTML = `
                <span>${email}</span>
                <button class="remove-btn" onclick="removeRecipient(this)">Remove</button>
            `;

            emailList.appendChild(emailItem);
            emailInput.value = '';

            updateRecipientCount();
            addLog(`Added recipient: ${email}`, 'success');
            showMessage(`Added ${email} to recipient list`, 'success');
        }

        function removeRecipient(button) {
            const emailItem = button.parentElement;
            const email = emailItem.querySelector('span').textContent;
            emailItem.remove();

            updateRecipientCount();
            addLog(`Removed recipient: ${email}`, 'info');
            showMessage(`Removed ${email} from recipient list`, 'success');
        }

        function updateRecipientCount() {
            const count = document.querySelectorAll('.email-item').length;
            document.getElementById('previewTo').textContent = `Recipients List (${count} emails)`;
        }

        function toggleSchedule() {
            const button = document.getElementById('toggleSchedule');
            const status = document.getElementById('scheduleStatus');
            const statusText = document.getElementById('statusText');
            const statusDescription = document.getElementById('statusDescription');
            const nextEmail = document.getElementById('nextEmail');

            isAutomationActive = !isAutomationActive;

            if (isAutomationActive) {
                button.textContent = '‚è∏Ô∏è Stop Automation';
                button.classList.remove('btn-primary');
                button.classList.add('btn-secondary');

                status.classList.remove('inactive');
                status.classList.add('active');
                status.querySelector('.status-icon').textContent = '‚úÖ';

                statusText.textContent = 'Active';
                statusDescription.textContent = 'Automation is running - emails will be sent daily at scheduled time';

                const scheduleTime = document.getElementById('scheduleTime').value;
                const nextDate = new Date();
                nextDate.setDate(nextDate.getDate() + 1);
                const nextDateStr = nextDate.toLocaleDateString() + ' at ' + scheduleTime;
                nextEmail.textContent = nextDateStr;

                addLog('Email automation started', 'success');
                showMessage('Email automation started successfully!', 'success');

                // Simulate automation activity
                simulateAutomationActivity();

            } else {
                button.textContent = '‚ñ∂Ô∏è Start Automation';
                button.classList.remove('btn-secondary');
                button.classList.add('btn-primary');

                status.classList.remove('active');
                status.classList.add('inactive');
                status.querySelector('.status-icon').textContent = '‚è∏Ô∏è';

                statusText.textContent = 'Inactive';
                statusDescription.textContent = 'Click "Start Automation" to begin daily email scheduling';
                nextEmail.textContent = 'Not scheduled';

                addLog('Email automation stopped', 'info');
                showMessage('Email automation stopped', 'success');
            }
        }

        function sendTestEmail() {
            const recipients = document.querySelectorAll('.email-item span');

            if (recipients.length === 0) {
                showMessage('Please add at least one recipient first', 'error');
                return;
            }

            // Simulate sending test email
            showMessage('Sending test email...', 'info');
            addLog('Sending test email to all recipients', 'info');

            setTimeout(() => {
                recipients.forEach(recipient => {
                    addLog(`Test email sent to ${recipient.textContent}`, 'success');
                });
                showMessage(`Test email sent to ${recipients.length} recipients!`, 'success');
            }, 2000);
        }

        function simulateAutomationActivity() {
            if (!isAutomationActive) return;

            setTimeout(() => {
                addLog('Checking schedule...', 'info');

                setTimeout(() => {
                    addLog('Fetching fun fact from API', 'info');

                    setTimeout(() => {
                        addLog('Fun fact retrieved successfully', 'success');
                        simulateAutomationActivity(); // Continue simulation
                    }, 3000);
                }, 2000);
            }, 10000);
        }

        function addLog(message, type) {
            const logsContainer = document.getElementById('activityLogs');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';

            const typeClass = type === 'success' ? 'log-success' :
                type === 'error' ? 'log-error' : 'log-info';

            const typeText = type.toUpperCase();

            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="${typeClass}">${typeText}: ${message}</span>
            `;

            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;

            // Keep only last 20 logs
            const logs = logsContainer.querySelectorAll('.log-entry');
            if (logs.length > 20) {
                logs[0].remove();
            }
        }

        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            const messageClass = type === 'success' ? 'success-message' : 'error-message';

            messageArea.innerHTML = `<div class="${messageClass}">${message}</div>`;

            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 4000);
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Update preview when settings change
        document.getElementById('emailSubject').addEventListener('input', function () {
            const subject = this.value.replace('{date}', new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }));
            document.getElementById('previewSubject').textContent = subject;
        });

        // Auto-refresh fact preview every 30 seconds
        setInterval(loadPreviewFact, 30000);
    </script>
</body>

</html>